:CONNECT SQLSERVERVM01

BACKUP CERTIFICATE My_SQLRES_ServerCert 
TO FILE = '\\192.168.100.101\share\Cer_My_SQLRES_ServerCert_backup.cer'
WITH PRIVATE KEY (
FILE = '\\192.168.100.101\share\private_key_My_SQLRES_ServerCert_backup.pvk',
ENCRYPTION BY PASSWORD = '7H0pF0$As^kWOP5')

GO
BACKUP LOG [AdventureWorks2019] 
TO DISK = N'\\192.168.100.101\share\AdventureWorks2019_TDE.bak' WITH NOFORMAT, NOINIT,  
NAME = N'AdventureWorks2019-Full Database Backup', SKIP, NOREWIND, NOUNLOAD, COMPRESSION, STATS = 10
GO

:CONNECT SQLSERVERVM02

--Create master key
CREATE MASTER KEY ENCRYPTION BY PASSWORD = '5(UmEZ40<49mzy-';
GO
-- Restore the certificate
GO
CREATE CERTIFICATE My_SQLRES_ServerCert 
FROM FILE = '\\192.168.100.101\share\Cer_My_SQLRES_ServerCert_backup.cer'
WITH PRIVATE KEY (
FILE = '\\192.168.100.101\share\private_key_My_SQLRES_ServerCert_backup.pvk',
DECRYPTION BY PASSWORD = '7H0pF0$As^kWOP5')
GO
ALTER DATABASE [AdventureWorks2019] SET HADR OFF;
GO
RESTORE LOG [AdventureWorks2019] 
FROM  DISK = N'\\192.168.100.101\share\AdventureWorks2019_TDE.bak' WITH  FILE = 1,  
NOUNLOAD, NORECOVERY, STATS = 10
GO
ALTER DATABASE [AdventureWorks2019] SET HADR AVAILABILITY GROUP = [AG];
GO

:CONNECT SQLSERVERVM03

--Create master key
CREATE MASTER KEY ENCRYPTION BY PASSWORD = '5(UmEZ40<49mzy-';
GO
-- Restore the certificate
GO
CREATE CERTIFICATE My_SQLRES_ServerCert 
FROM FILE = '\\192.168.100.101\share\Cer_My_SQLRES_ServerCert_backup.cer'
WITH PRIVATE KEY (
FILE = '\\192.168.100.101\share\private_key_My_SQLRES_ServerCert_backup.pvk',
DECRYPTION BY PASSWORD = '7H0pF0$As^kWOP5')
GO
ALTER DATABASE [AdventureWorks2019] SET HADR OFF;
GO
RESTORE LOG [AdventureWorks2019] 
FROM  DISK = N'\\192.168.100.101\share\AdventureWorks2019_TDE.bak' WITH  FILE = 1,  
NOUNLOAD, NORECOVERY, STATS = 10
GO
ALTER DATABASE [AdventureWorks2019] SET HADR AVAILABILITY GROUP = [AG];
GO

