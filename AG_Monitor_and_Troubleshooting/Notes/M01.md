## Wait statistics

### HADR_SYNC_COMMIT  

Waiting for transaction commit processing for the synchronized secondary databases to harden the log. This wait is also reflected by the Transaction Delay performance counter. This wait type is expected for synchronized availability groups and indicates the time to send, write, and acknowledge log to the secondary databases. 

---

### HADR_CLUSAPI_CALL 

The `HADR_CLUSAPI_CALL` wait type is part of the **AlwaysOn Availability Groups** infrastructure in SQL Server. It occurs when a SQL Server thread needs to **switch from non-preemptive to preemptive mode** in order to **invoke Windows Server Failover Clustering (WSFC) APIs**.

This wait type is triggered during operations that require SQL Server to interact with the underlying cluster infrastructure, such as:
- Opening cluster resources
- Enumerating cluster nodes or networks
- Reading cluster network properties
- Validating cluster health and configuration.

These operations are handled by external Windows APIs, which SQL Server must call in preemptive mode, meaning the OS‚Äînot SQL Server‚Äîcontrols the scheduling of the thread during that time.

### üìà What Does a High Number of `HADR_CLUSAPI_CALL` Waits Indicate?

While this wait type is **typically benign**, a **high accumulation** may signal:
- **Cluster communication delays** (e.g., DNS resolution issues, slow network adapters, or misconfigured IPs/subnets)
- **Resource contention** in the cluster (e.g., disk latency or overloaded cluster nodes)
- **Frequent querying of cluster metadata** (e.g., from system views like `sys.availability_databases_cluster` or `sys.availability_replicas`).

If you observe high values, it's recommended to:
- Run **Cluster Validation** (outside SQL Server uptime)
- Check **network health**, including cables, adapters, and DNS
- Review **cluster logs** and **event viewer** for anomalies

### üß≠ Where Does It Typically Appear ‚Äî Primary or Secondary Node?

This wait type is **most commonly observed on the primary node**, because:
- The primary node is responsible for **coordinating cluster-level operations**, such as failover decisions, replica health checks, and listener updates.
- These operations often involve **calls to WSFC APIs**, which trigger the `HADR_CLUSAPI_CALL` wait.

However, it can also appear on secondary nodes if they are involved in cluster metadata queries or health checks, but this is less frequent.

### üõ†Ô∏è Monitoring and Troubleshooting Tips

To monitor this wait type:
- Use the DMV: `sys.dm_os_wait_stats`
- Filter for `HADR_CLUSAPI_CALL` and track its **wait_time_ms** and **waiting_tasks_count**
- Correlate with other AlwaysOn wait types like `HADR_SYNC_COMMIT`, `HADR_LOGCAPTURE_WAIT`, and `WRITELOG` for a full picture.

---

### HADR_LOGCAPTURE_WAIT (on the primary replica)

The wait type **`HADR_LOGCAPTURE_WAIT`** in SQL Server is specific to **Always On Availability Groups** and relates to the log capture process on the **primary replica**. Here‚Äôs what it means and what it could indicate:

### ‚úÖ **What It Is?**
- This wait occurs when the **log capture mechanism** (responsible for reading transaction log records and sending them to secondary replicas) is **waiting for new log records to become available**.
- It can also happen when the log capture thread is **reading from disk** because the required log records are not in the log cache.

### ‚úÖ **Is It Normal?**
- **Yes, it‚Äôs an expected wait** when:
  - The log capture thread has caught up to the end of the log.
  - There is no new transaction activity.
- In these cases, the wait is benign and can usually be ignored.
  
### ‚úÖ **When to Investigate**
If you see **high or sustained values** for `HADR_LOGCAPTURE_WAIT`, it might indicate:
1. **Transaction Log Issues**  
   - Slow log generation or delays in flushing log records to disk.
2. **I/O Bottlenecks**  
   - Disk latency on the primary replica can delay log capture.
3. **High Transaction Rate**  
   - Heavy workload generating logs faster than they can be processed.
4. **Secondary Replica Sync Problems**  
   - If secondaries frequently lose synchronization, this wait may correlate with other HADR waits like `HADR_SYNC_COMMIT`.
   
### ‚úÖ **Troubleshooting Steps**
- Check **PerfMon counters** for Availability Groups (e.g., `Log Send Queue Size`, `Log Bytes Flushed/sec`).
- Review **SQL Server error logs** for I/O or Always On warnings.
- Use **DMVs** like `sys.dm_os_wait_stats` and `sys.dm_hadr_database_replica_states` to correlate with other waits.
- Investigate **disk performance** and **network latency** between replicas.
  
---

### HADR_SYNCHRONIZING_THROTTLE 

Waiting for transaction commit processing to allow a synchronizing secondary database to catch up to the primary end of log in order to transition to the synchronized state. This is an expected wait when a secondary database is catching up. 

### WRITELOG 

Occurs while waiting for a log flush to complete. Common operations that cause log flushes are checkpoints and transaction commits.
