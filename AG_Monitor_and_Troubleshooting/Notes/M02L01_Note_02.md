### ‚úÖ **What Are Failure Condition Levels?**
Failure condition levels define **what health conditions trigger an automatic failover** in Always On Availability Groups or Failover Cluster Instances. They work in conjunction with **sp_server_diagnostics** and the Windows Server Failover Cluster (WSFC) health checks.

- There are **five levels (1‚Äì5)**, from least to most restrictive. Each higher level includes all conditions from the previous levels.
- **Default value:** Level 3 (critical server errors).

---

### üîç **Levels Explained**
| Level | Trigger Conditions |
|-------|---------------------|
| **1 ‚Äì OnServerDown** | SQL Server service is down OR WSFC lease expires (no ACK from SQL instance). |
| **2 ‚Äì OnServerUnresponsive** | SQL instance fails to connect to cluster and exceeds `HEALTH_CHECK_TIMEOUT`, or replica is in failed state. |
| **3 ‚Äì OnCriticalServerError** | Critical internal errors (e.g., orphaned spinlocks, severe write-access violations, excessive memory dumps). |
| **4 ‚Äì OnModerateServerError** | Moderate internal errors like persistent out-of-memory in internal resource pool. |
| **5 ‚Äì OnAnyQualifiedFailure** | Includes all above plus conditions like worker thread exhaustion or unsolvable deadlocks. |

> **Important:** Damaged or suspect databases do **not** trigger automatic failover at any level.

---

### ‚öôÔ∏è **How to Configure FailureConditionLevel**
You can set this property at the **availability group** or **Failover Cluster Instance** level using:

#### **1. Transact-SQL**
```sql
ALTER AVAILABILITY GROUP [YourAGName]
SET (FAILURE_CONDITION_LEVEL = 3);
```

#### **2. PowerShell**
```powershell
Import-Module FailoverClusters
$fci = "SQL Server (INST1)"
Get-ClusterResource $fci | Set-ClusterParameter FailureConditionLevel 3
```

#### **3. Failover Cluster Manager GUI**
- Open **Failover Cluster Manager** ‚Üí Expand **Services and Applications** ‚Üí Select your FCI.
- Right-click the SQL Server resource ‚Üí **Properties** ‚Üí Set `FailureConditionLevel` value.

---

### ‚úÖ **Best Practices**
- Keep **default Level 3** for balanced sensitivity.
- Use **Level 1 or 2** for critical systems where uptime is paramount.
- Use **Level 4 or 5** only if you want aggressive failover for internal errors.
- Always test failover behavior in a **non-production environment** before applying changes.

